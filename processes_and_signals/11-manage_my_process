#!/usr/bin/env bash
# manage_my_process.

PIDFILE=/var/run/my_process.pid
DAEMON="./manage_my_process"

start_daemon() {
  # Start in background and capture its PID
  $DAEMON &>/dev/null &
  echo $! > "$PIDFILE"
}

stop_daemon() {
  if [ -f "$PIDFILE" ]; then
    pid=$(cat "$PIDFILE")
    kill "$pid" 2>/dev/null || true
    rm -f "$PIDFILE"
  else
    # fallback: try to kill by process name (best-effort)
    pkill -f "$(basename "$DAEMON")" 2>/dev/null || true
  fi
}

case "$1" in
  start)
    start_daemon
    echo "manage_my_process started"
    ;;
  stop)
    stop_daemon
    echo "manage_my_process stopped"
    ;;
  restart)
    stop_daemon
    # small pause to let kernel clean up the old PID (optional)
    sleep 1
    start_daemon
    echo "manage_my_process restarted"
    ;;
  *)
    echo "Usage: manage_my_process {start|stop|restart}"
    exit 1
    ;;
esac
