#!/usr/bin/env bash
# manage_my_process

PIDFILE=/var/run/my_process.pid
DAEMON=./manage_my_process

case "$1" in
  start)
    # start the daemon in background and save its PID (use $! for the bg PID)
    $DAEMON &
    echo $! > "$PIDFILE"
    echo "manage_my_process started"
    ;;
  stop)
    # stop the daemon using the PID file if present
    if [ -f "$PIDFILE" ]; then
      pid=$(cat "$PIDFILE")
      kill "$pid" 2>/dev/null || true
      rm -f "$PIDFILE"
    else
      # fallback: try to kill by name (non-fatal)
      pkill -f "$(basename "$DAEMON")" 2>/dev/null || true
    fi
    echo "manage_my_process stopped"
    ;;
  restart)
    # stop (if running) then start again
    if [ -f "$PIDFILE" ]; then
      pid=$(cat "$PIDFILE")
      kill "$pid" 2>/dev/null || true
      rm -f "$PIDFILE"
    else
      pkill -f "$(basename "$DAEMON")" 2>/dev/null || true
    fi

    $DAEMON &
    echo $! > "$PIDFILE"
    echo "manage_my_process restarted"
    ;;
  *)
    echo "Usage: manage_my_process {start|stop|restart}"
    ;;
esac
